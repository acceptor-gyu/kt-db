# Storage Engine 테스트 시나리오

## 개요

`storage_engine` 패키지는 InnoDB 스타일의 저장소 엔진을 구현합니다. 이 문서는 각 컴포넌트의 단위 테스트 시나리오를 정의합니다.

---

## 1. IntFieldEncoder 테스트

INT 값을 Big Endian 4바이트로 직렬화/역직렬화하는 클래스입니다.

### 1.1 encode() 테스트

| 시나리오 | 입력 | 예상 결과 |
|----------|------|-----------|
| 양수 인코딩 | `123` | 4바이트 Big Endian 배열 |
| 0 인코딩 | `0` | `[0x00, 0x00, 0x00, 0x00]` |
| 음수 인코딩 | `-1` | `[0xFF, 0xFF, 0xFF, 0xFF]` |
| 최대값 인코딩 | `Int.MAX_VALUE` | `[0x7F, 0xFF, 0xFF, 0xFF]` |
| 최소값 인코딩 | `Int.MIN_VALUE` | `[0x80, 0x00, 0x00, 0x00]` |

### 1.2 decode() 테스트

| 시나리오 | 입력 | 예상 결과 |
|----------|------|-----------|
| 양수 디코딩 | encode(123) 결과 | `123` |
| 0 디코딩 | `[0x00, 0x00, 0x00, 0x00]` | `0` |
| 음수 디코딩 | `[0xFF, 0xFF, 0xFF, 0xFF]` | `-1` |
| 최대값 디코딩 | `[0x7F, 0xFF, 0xFF, 0xFF]` | `Int.MAX_VALUE` |
| 최소값 디코딩 | `[0x80, 0x00, 0x00, 0x00]` | `Int.MIN_VALUE` |

### 1.3 왕복(Round-trip) 테스트

| 시나리오 | 설명 |
|----------|------|
| encode-decode 왕복 | 임의의 INT 값을 encode 후 decode하면 원본 값 복원 |

---

## 2. RowEncoder 테스트

여러 INT 컬럼을 하나의 Row(byte 배열)로 변환하는 클래스입니다.

### 2.1 encodeRow() 테스트

| 시나리오 | 입력 | 예상 결과 |
|----------|------|-----------|
| 단일 컬럼 인코딩 | `intArrayOf(1)` | 4바이트 배열 |
| 다중 컬럼 인코딩 | `intArrayOf(1, 2, 3)` | 12바이트 배열 |
| 빈 배열 인코딩 | `intArrayOf()` | 0바이트 배열 |
| 음수 포함 인코딩 | `intArrayOf(-1, 0, 1)` | 12바이트 배열 |

### 2.2 decodeRow() 테스트

| 시나리오 | 입력 | 예상 결과 |
|----------|------|-----------|
| 단일 컬럼 디코딩 | 4바이트 배열 | 1개 원소 IntArray |
| 다중 컬럼 디코딩 | 12바이트 배열 | 3개 원소 IntArray |
| 빈 배열 디코딩 | 0바이트 배열 | 빈 IntArray |

### 2.3 왕복(Round-trip) 테스트

| 시나리오 | 설명 |
|----------|------|
| encodeRow-decodeRow 왕복 | 임의의 IntArray를 encode 후 decode하면 원본 배열 복원 |

---

## 3. Page 테스트

페이지 ID와 데이터를 담는 데이터 클래스입니다.

### 3.1 생성 테스트

| 시나리오 | 설명 |
|----------|------|
| 기본 생성 | id와 data로 Page 인스턴스 생성 |
| 데이터 접근 | 생성된 Page에서 id, data 필드 접근 가능 |

### 3.2 동등성 테스트

| 시나리오 | 설명 |
|----------|------|
| 같은 id/data | 같은 id와 data를 가진 Page는 동등해야 함 |
| 다른 id | 다른 id를 가진 Page는 동등하지 않음 |
| 다른 data | 다른 data를 가진 Page는 동등하지 않음 |

---

## 4. PageManager 테스트

파일에서 Page 단위로 데이터를 읽어 메모리에 적재하는 클래스입니다.

### 4.1 readAll() 테스트

| 시나리오 | 설명 |
|----------|------|
| 파일 전체 읽기 | 파일을 PAGE_SIZE 단위로 분할하여 메모리에 적재 |
| 각 페이지 크기 검증 | 모든 페이지가 PAGE_SIZE 크기를 가짐 |
| 데이터 일치 검증 | 페이지 데이터가 파일 내용과 일치 |
| 재호출 시 초기화 | readAll() 재호출 시 페이지 목록 초기화 후 재로드 |
| 빈 파일 읽기 | 빈 파일 로드 시 페이지 수 0 |
| 부분 페이지 | PAGE_SIZE보다 작은 파일도 1페이지로 읽기 |

### 4.2 readAt() 테스트

| 시나리오 | 설명 |
|----------|------|
| 특정 페이지 읽기 | readAll() 후 특정 페이지 ID로 데이터 조회 |
| 첫 번째 페이지 | id=0으로 첫 번째 페이지 데이터 조회 |
| 마지막 페이지 | 마지막 페이지 ID로 데이터 조회 |
| 중간 페이지 | 중간 페이지 ID로 데이터 조회 및 offset 검증 |

### 4.3 pageCount() 테스트

| 시나리오 | 설명 |
|----------|------|
| readAll() 전 | 0 반환 |
| readAll() 후 | 올바른 페이지 수 반환 |
| 파일 크기 기반 계산 | 2.5 페이지 크기 파일 → 3페이지 |

### 4.4 isLoaded() 테스트

| 시나리오 | 설명 |
|----------|------|
| readAll() 전 | false 반환 |
| readAll() 후 | true 반환 |
| 빈 파일 로드 후 | false 반환 |

### 4.5 예외 처리 테스트

| 시나리오 | 설명 |
|----------|------|
| readAll() 전 readAt() | IllegalArgumentException + "out of bounds" 메시지 |
| 범위 외 페이지 ID | IllegalArgumentException + 페이지 ID와 유효 범위 메시지 |
| 음수 페이지 ID | IllegalArgumentException + "-1" 포함 메시지 |
| Int.MAX_VALUE 접근 | IllegalArgumentException |
| 정확한 경계값 | 마지막 유효 ID는 성공, 그 다음은 실패 |

### 4.6 경계값 테스트

| 시나리오 | 설명 |
|----------|------|
| 단일 페이지 파일 | 페이지 0 접근 성공, 페이지 1 접근 실패 |
| 정확히 2페이지 파일 | 페이지 0, 1 접근 성공, 페이지 2 접근 실패 |

### 4.7 데이터 무결성 테스트

| 시나리오 | 설명 |
|----------|------|
| 연속 페이지 데이터 연속성 | 현재 페이지 마지막 바이트 + 1 == 다음 페이지 첫 바이트 |
| 동일 페이지 반복 읽기 | 여러 번 읽어도 동일한 데이터 반환 |

---

## 테스트 실행

```bash
# 전체 테스트 실행
./gradlew test

# storage_engine 테스트만 실행
./gradlew test --tests "study.db.storage_engine.*"
```
